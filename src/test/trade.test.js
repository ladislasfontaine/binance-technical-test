const assert = require("assert/strict");
const { getHighestVolumePairs } = require("../app/trade");

const mockTicker24h = [
  {
    symbol: "BNBBTC",
    priceChange: "-94.99999800",
    priceChangePercent: "-95.960",
    weightedAvgPrice: "0.29628482",
    prevClosePrice: "0.10002000",
    lastPrice: "4.00000200",
    lastQty: "200.00000000",
    bidPrice: "4.00000000",
    bidQty: "100.00000000",
    askPrice: "4.00000200",
    askQty: "100.00000000",
    openPrice: "99.00000000",
    highPrice: "100.00000000",
    lowPrice: "0.10000000",
    volume: "8913.30000000",
    quoteVolume: "15.30000000",
    openTime: 1499783499040,
    closeTime: 1499869899040,
    firstId: 28385, // First tradeId
    lastId: 28460, // Last tradeId
    count: 76, // Trade count
  },
  {
    symbol: "TEST1",
    priceChange: "-94.99999800",
    priceChangePercent: "-95.960",
    weightedAvgPrice: "0.29628482",
    prevClosePrice: "0.10002000",
    lastPrice: "4.00000200",
    lastQty: "200.00000000",
    bidPrice: "4.00000000",
    bidQty: "100.00000000",
    askPrice: "4.00000200",
    askQty: "100.00000000",
    openPrice: "99.00000000",
    highPrice: "100.00000000",
    lowPrice: "0.10000000",
    volume: "813.30000000",
    quoteVolume: "15.30000000",
    openTime: 1499783499040,
    closeTime: 1499869899040,
    firstId: 28385, // First tradeId
    lastId: 28460, // Last tradeId
    count: 76, // Trade count
  },
  {
    symbol: "TEST2",
    priceChange: "-94.99999800",
    priceChangePercent: "-95.960",
    weightedAvgPrice: "0.29628482",
    prevClosePrice: "0.10002000",
    lastPrice: "4.00000200",
    lastQty: "200.00000000",
    bidPrice: "4.00000000",
    bidQty: "100.00000000",
    askPrice: "4.00000200",
    askQty: "100.00000000",
    openPrice: "99.00000000",
    highPrice: "100.00000000",
    lowPrice: "0.10000000",
    volume: "89139999.30000012",
    quoteVolume: "15.30000000",
    openTime: 1499783499040,
    closeTime: 1499869899040,
    firstId: 28385, // First tradeId
    lastId: 28460, // Last tradeId
    count: 76, // Trade count
  },
];

const mockTradeStream = [
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868109932,
      s: "SHIBUSDT",
      t: 287168757,
      p: "0.00002921",
      q: "457244.00",
      b: 1115365554,
      a: 1115365557,
      T: 1644868109931,
      m: true,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868110693,
      s: "SHIBUSDT",
      t: 287168758,
      p: "0.00002920",
      q: "171232876.00",
      b: 1115328519,
      a: 1115365602,
      T: 1644868110692,
      m: true,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868111608,
      s: "SHIBUSDT",
      t: 287168759,
      p: "0.00002921",
      q: "13108234.00",
      b: 1115365627,
      a: 1115365649,
      T: 1644868111607,
      m: true,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111633,
      s: "SHIBBUSD",
      t: 61182632,
      p: "0.00002923",
      q: "23256690.00",
      b: 361329345,
      a: 361329295,
      T: 1644868111632,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111650,
      s: "SHIBBUSD",
      t: 61182633,
      p: "0.00002923",
      q: "25000000.00",
      b: 361329348,
      a: 361329295,
      T: 1644868111649,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111653,
      s: "SHIBBUSD",
      t: 61182634,
      p: "0.00002923",
      q: "100000000.00",
      b: 361329349,
      a: 361329295,
      T: 1644868111652,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111661,
      s: "SHIBBUSD",
      t: 61182635,
      p: "0.00002923",
      q: "188322748.00",
      b: 361329351,
      a: 361329295,
      T: 1644868111661,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868111701,
      s: "SHIBUSDT",
      t: 287168760,
      p: "0.00002922",
      q: "5133470.00",
      b: 1115365679,
      a: 1115365371,
      T: 1644868111700,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibeur@trade",
    data: {
      e: "trade",
      E: 1644868111711,
      s: "SHIBEUR",
      t: 9727739,
      p: "0.00002591",
      q: "5133470.00",
      b: 103673784,
      a: 103673788,
      T: 1644868111711,
      m: true,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111713,
      s: "SHIBBUSD",
      t: 61182636,
      p: "0.00002923",
      q: "100000000.00",
      b: 361329352,
      a: 361329295,
      T: 1644868111711,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111714,
      s: "SHIBBUSD",
      t: 61182637,
      p: "0.00002923",
      q: "265000000.00",
      b: 361329353,
      a: 361329295,
      T: 1644868111713,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibtry@trade",
    data: {
      e: "trade",
      E: 1644868111717,
      s: "SHIBTRY",
      t: 31880021,
      p: "0.00040045",
      q: "249719.00",
      b: 206414645,
      a: 206414627,
      T: 1644868111716,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111755,
      s: "SHIBBUSD",
      t: 61182638,
      p: "0.00002923",
      q: "100000000.00",
      b: 361329360,
      a: 361329295,
      T: 1644868111754,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868111806,
      s: "SHIBUSDT",
      t: 287168761,
      p: "0.00002923",
      q: "6567321.00",
      b: 1115365704,
      a: 1115365212,
      T: 1644868111804,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111956,
      s: "SHIBBUSD",
      t: 61182639,
      p: "0.00002923",
      q: "12747113.00",
      b: 361329367,
      a: 361329295,
      T: 1644868111955,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868111959,
      s: "SHIBBUSD",
      t: 61182640,
      p: "0.00002923",
      q: "13118229.00",
      b: 361329368,
      a: 361329295,
      T: 1644868111958,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868112035,
      s: "SHIBBUSD",
      t: 61182641,
      p: "0.00002923",
      q: "100000000.00",
      b: 361329371,
      a: 361329295,
      T: 1644868112035,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112250,
      s: "SHIBUSDT",
      t: 287168762,
      p: "0.00002922",
      q: "25844000.00",
      b: 1115365681,
      a: 1115365722,
      T: 1644868112250,
      m: true,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868112445,
      s: "SHIBBUSD",
      t: 61182642,
      p: "0.00002923",
      q: "108358021.00",
      b: 361329373,
      a: 361329295,
      T: 1644868112444,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112529,
      s: "SHIBUSDT",
      t: 287168763,
      p: "0.00002922",
      q: "852428.00",
      b: 1115365683,
      a: 1115365746,
      T: 1644868112527,
      m: true,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112633,
      s: "SHIBUSDT",
      t: 287168764,
      p: "0.00002923",
      q: "10906283.00",
      b: 1115365748,
      a: 1115365212,
      T: 1644868112632,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112633,
      s: "SHIBUSDT",
      t: 287168765,
      p: "0.00002923",
      q: "684697.00",
      b: 1115365748,
      a: 1115365256,
      T: 1644868112632,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112633,
      s: "SHIBUSDT",
      t: 287168766,
      p: "0.00002923",
      q: "26612379.00",
      b: 1115365748,
      a: 1115365442,
      T: 1644868112632,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112633,
      s: "SHIBUSDT",
      t: 287168767,
      p: "0.00002923",
      q: "5000000.00",
      b: 1115365748,
      a: 1115365685,
      T: 1644868112632,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868112633,
      s: "SHIBUSDT",
      t: 287168768,
      p: "0.00002923",
      q: "27172650.00",
      b: 1115365748,
      a: 1115365711,
      T: 1644868112632,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868112641,
      s: "SHIBBUSD",
      t: 61182643,
      p: "0.00002923",
      q: "8413673.00",
      b: 361329375,
      a: 361329295,
      T: 1644868112640,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibbusd@trade",
    data: {
      e: "trade",
      E: 1644868112642,
      s: "SHIBBUSD",
      t: 61182644,
      p: "0.00002923",
      q: "9157226.00",
      b: 361329376,
      a: 361329295,
      T: 1644868112641,
      m: false,
      M: true,
    },
  },
  {
    stream: "shibusdt@trade",
    data: {
      e: "trade",
      E: 1644868113105,
      s: "SHIBUSDT",
      t: 287168769,
      p: "0.00002922",
      q: "1743038.00",
      b: 1115365683,
      a: 1115365772,
      T: 1644868113104,
      m: true,
      M: true,
    },
  },
];

const mockTenPairs = [
  "SHIBUSDT",
  "BTTCUSDT",
  "SHIBBUSD",
  "SHIBTRY",
  "BTTCUSDC",
  "SHIBEUR",
  "BTTCTRY",
  "SHIBDOGE",
  "SHIBAUD",
  "WINUSDT",
];

describe("getHighestVolumePairs", () => {
  it("should order data based on volume", () => {
    const result = getHighestVolumePairs(mockTicker24h, 10);
    assert.deepEqual(result, ["TEST2", "BNBBTC", "TEST1"]);
  });

  it("should not return more than the desired quantity", () => {
    const result = getHighestVolumePairs(mockTicker24h, 2);
    assert.deepEqual(result, ["TEST2", "BNBBTC"]);
  });
});
